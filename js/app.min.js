"use strict";!function(){var t=void 0,e=void 0,n=45e3,a=document.querySelector(".chat"),o=document.querySelector(".content"),r=function(t,e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.timeout=5e3,n.onload=function(){if(n.status>=200&&n.status<400)try{var t=JSON.parse(n.responseText);e(t)}catch(a){e(!1)}else e(!1)},n.ontimeout=function(){e(!1)},n.onerror=function(){e(!1)},n.send()},s=function(t){var e=arguments.length<=1||void 0===arguments[1]?"user":arguments[1],n=document.createElement("section"),o=function(t,e){setTimeout(function(){t.classList.add("show")},150*e?150*e:10)},r=void 0,s=function(){a.scrollTop+=Math.floor(n.offsetHeight/18)};if(n.classList.add("message"),n.classList.add(e),n.innerHTML="<p>"+t+"</p>",a.appendChild(n),r=window.setInterval(s,16),setTimeout(function(){window.clearInterval(r),a.scrollTop=a.scrollHeight},300),setTimeout(function(){n.classList.add("show")},10),"user"===e){for(var i=a.querySelectorAll("button:not(:disabled)"),l=0;l<i.length;l+=1)o(i[l],l);n.classList.add("active")}},i=function(t){return t[Math.floor(Math.random()*t.length)]},l=function(){setTimeout(function(){s('<button class="choice style apa">APA</button><button class="choice style vancouver">Vancouver</button>')},300)},u=function(){var e=document.querySelector(".active"),n=["Har du somnat? &#x1F634;","PubMed and Chill? &#x2615;","Är du kvar?","&#x2744; &#x1F331; &#x1F31E; &#x1F342;"];e&&e.parentNode.removeChild(e),s(i(n),"bot"),setTimeout(function(){var e=['Undrar du något kan du ringa <a href="tel:0852484000">08-524 840 00</a>, eller komma in till oss i KIB-labb mellan 11-16 på vardagar. &#x1F46B;','Kom in till oss i KIB-labb mellan 11-16 på vardagar om du behöver mer hjälp eller ring <a href="tel:0852484000">08-524 840 00</a>. &#x1F4F2;',"Vill du prata referenser med en riktig person? &#x1F4AC; Kom in till oss i KIB-labb mellan 11-16 på vardagar."];s(i(e),"bot"),setTimeout(function(){var e=["Jag vill veta mer om hur jag refererar &#x1F61E;","Vad är referenser nu igen? &#x1F631;","Kan jag läsa mer om referenser någonstans? &#x1F680;"],n=["Låt mig välja referensstil igen &#x1F4A1;","Jag vill sätta igång! &#x1F525;","Ok, kör &#x1F697;"],a=["Visa kategorierna igen tack &#x2705;","Ok, kör igen! &#x1F697;","Jag vill välja källa &#x1F44D;"];s(t?'<button class="choice newmenu showinfo">'+i(e)+'</button><br /><button class="choice newmenu showmenu">'+i(a)+"</button>":'<button class="choice newmenu showinfo">'+i(e)+'</button><br /><button class="choice newmenu showstart">'+i(n)+"</button>")},300)},500)},c=function(t){var a=["Hej, välkommen till KIBs referensguide! &#x1F603; I vilket format ska din referens vara? &#x1F64B;","Hej! &#x1F44B; Välkommen till vår referensguide! Vilken referensstil använder du?"],o=["Hmm, försök igen &#x1F635;","Typiskt, är det inte din uppkoppling kan felet ligga hos oss &#x1F6A7; Testa gärna igen.","&#x1F44E; Försök igen eller återkom senare..."];e=window.setInterval(function(){window.clearInterval(e),u()},n),t?s(i(o),"bot"):s(i(a),"bot"),l()},d=function(t){t.parentNode.parentNode.classList.add("selected"),t.parentNode.parentNode.classList.remove("active"),t.parentNode.innerHTML=t.textContent},m=function(o){var r="",l=a.querySelector("button.newmenu"),c=["Här är listan på källor igen... &#x1F64F;","&#x1F331; Varsågod, kolla in något annat!","Testa någon av de här... &#x1F64C;"],m=["Vilken typ av källa är referensen? &#x1F4DA; &#x1F4F0; &#x1F4CA;","Vad är det för typ av referens du undrar över?","Börja med att välja en kategori &#x2B50;"];l&&d(l),setTimeout(function(){o?s(i(c),"bot"):s(i(m),"bot"),t.menu.forEach(function(t,e){r+='<button class="choice menu" data-submenu="'+e+'">'+t.title+"</button>"}),setTimeout(function(){s(r)},500)},500),e=window.setInterval(function(){window.clearInterval(e),u()},n)},f=function(n){var a=["Ok, vänta... &#x1F4AA;","Ett ögonblick... &#x1F440;","En sekund bara... &#x1F60E;"];s(i(a),"bot"),r("https://tools.kib.ki.se/jsonendpoint/referenceguide/"+n,function(n){if(n){var a="";a+='<button class="close" aria-label="Stäng">&times;</button>',t=n,t.examples.forEach(function(t){a+='<article id="'+t.id+'">\n                         <h3>'+t.title+"</h3>\n                         "+t.body+"\n                       </article>"}),o.innerHTML=a,m()}else{var r=["&#x1F622; Oops, något gick fel...","Men... &#x1F621;","Något funkar inte just nu &#x1F62B;"];window.clearInterval(e),s(i(r),"bot"),setTimeout(function(){c(!0)},300)}})},b=function(e){var n="",a=t.menu[e.getAttribute("data-submenu")],o=["&#x1F44D; Vad vill du lära dig referera till?","Vad vill du veta mer om? &#x1F648;","Någon av de här som passar?"],r=["Jag vill välja en annan källa än "+a.title.toLowerCase()+" &#x1F61C;","Visa de andra källorna igen &#x1F633;",a.title+" i all ära, men kollar gärna något annat nu... &#x1F612;"];a.submenu.forEach(function(t){var e=a.id+"-"+t.id;n+='<button class="choice submenu" aria-controls="'+e+'" data-content="'+e+'">'+t.title+"</button>"}),n+='<br /><button class="choice submenu newmenu">'+i(r)+"</button>",setTimeout(function(){s(i(o),"bot"),setTimeout(function(){s(n)},300)},500)},v=function(t){var e=a.querySelectorAll("button");t?(t.classList.add("show"),a.setAttribute("aria-hidden","true"),o.setAttribute("aria-hidden","false"),o.tabIndex="0",o.focus()):(o.setAttribute("aria-hidden","true"),o.tabIndex="-1",a.setAttribute("aria-hidden","false"),history.state&&"content"===history.state.id&&history.back(),setTimeout(function(){var t=document.querySelector(".content article.show");t&&(t.classList.remove("show"),a.querySelector('button[data-content="'+t.id+'"]').focus())},300));for(var n=0;n<e.length;n+=1)e[n].tabIndex=t?"-1":"0"},g=function(t){t.classList.contains("newmenu")?m(!0):(v(document.getElementById(t.getAttribute("data-content"))),history.pushState({id:"content"},"","#"+t.getAttribute("data-content")))};document.addEventListener("click",function(n){n.target.classList.contains("choice")&&(window.clearInterval(e),n.target.classList.contains("submenu")||d(n.target),n.target.classList.contains("style")&&f(n.target.textContent.toLowerCase()),n.target.classList.contains("menu")&&b(n.target),n.target.classList.contains("submenu")&&g(n.target),n.target.classList.contains("showstart")&&l(),n.target.classList.contains("showmenu")&&m(!0),n.target.classList.contains("showinfo")&&!function(){var e=["Här kan du läsa mer om hur du refererar","På vår webbplats kan du läsa mer om referenser","Ok, kolla den här länken:"],n=["OK &#x1F60E;","Hur kommer jag tillbaka? &#x1F312;","Ok, jag är redo! &#x1F44C;"];setTimeout(function(){s(i(e)+' <a target="_new" href="https://kib.ki.se/skriva-referera/skriva-referenser">https://kib.ki.se/skriva-referera/skriva-referenser</a>',"bot"),setTimeout(function(){s(t?'<button class="choice newmenu showmenu">'+i(n)+"</button>":'<button class="choice newmenu showstart">'+i(n)+"</button>")},300)},500)}()),n.target.classList.contains("close")&&v()}),document.addEventListener("keydown",function(t){27===t.keyCode&&v()}),window.addEventListener("popstate",function(){v()}),setTimeout(function(){c()},500)}();