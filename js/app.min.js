"use strict";var refguide=void 0,sleeping=void 0,sleeptime=45e3,chat=document.querySelector(".chat"),content=document.querySelector(".content"),getJSON=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.timeout=5e3,n.onload=function(){if(n.status>=200&&n.status<400)try{var e=JSON.parse(n.responseText);t(e)}catch(a){t(!1)}else t(!1)},n.ontimeout=function(){t(!1)},n.onerror=function(){t(!1)},n.send()},newMessage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"user",n=document.createElement("li"),a=function(e,t){setTimeout(function(){e.classList.add("show")},150*t?150*t:10)},o=void 0,s=function(){chat.scrollTop+=Math.floor(n.offsetHeight/18)};if(n.classList.add("message"),n.classList.add(t),n.innerHTML="user"===t?"<nav>"+e+"</nav>":"<p>"+e+"</p>",chat.appendChild(n),o=window.setInterval(s,16),setTimeout(function(){window.clearInterval(o),chat.scrollTop=chat.scrollHeight},300),setTimeout(function(){n.classList.add("show")},10),"user"===t){for(var r=chat.querySelectorAll("button:not(:disabled)"),i=0;i<r.length;i+=1)a(r[i],i);n.classList.add("active")}},randomReply=function(e){return e[Math.floor(Math.random()*e.length)]},startAlternatives=function(){newMessage('<button class="choice style apa">APA</button><button class="choice style vancouver">Vancouver</button>')},checkUp=function(){var e=document.querySelector(".active"),t=["Har du somnat? &#x1F634;","PubMed and Chill? &#x2615;","Är du kvar?","&#x2744; &#x1F331; &#x1F31E; &#x1F342;"];e&&e.parentNode.removeChild(e),newMessage(randomReply(t),"bot"),setTimeout(function(){var e=['Undrar du något kan du ringa <a href="tel:0852484000">08-524 840 00</a>, eller komma in till oss i KIB-labb mellan 11-16 på vardagar. &#x1F46B;','Kom in till oss i KIB-labb mellan 11-16 på vardagar om du behöver mer hjälp eller ring <a href="tel:0852484000">08-524 840 00</a>. &#x1F4F2;',"Vill du prata referenser med en riktig person? &#x1F4AC; Kom in till oss i KIB-labb mellan 11-16 på vardagar."];newMessage(randomReply(e),"bot"),setTimeout(function(){var e=["Jag vill veta mer om hur jag refererar &#x1F61E;","Vad är referenser nu igen? &#x1F631;","Kan jag läsa mer om referenser någonstans? &#x1F680;"],t=["Låt mig välja referensstil igen &#x1F4A1;","Jag vill sätta igång! &#x1F525;","Ok, kör &#x1F697;"],n=["Visa kategorierna igen tack &#x2705;","Ok, kör igen! &#x1F697;","Jag vill välja källa &#x1F44D;"];newMessage(refguide?'<button class="choice newmenu showinfo">'+randomReply(e)+'</button><br /><button class="choice newmenu showmenu">'+randomReply(n)+"</button>":'<button class="choice newmenu showinfo">'+randomReply(e)+'</button><br /><button class="choice newmenu showstart">'+randomReply(t)+"</button>")},300)},500)},init=function(e){var t=["Hej, välkommen till KIBs referensguide! &#x1F603; I vilket format ska din referens vara? &#x1F64B;","Hej! &#x1F44B; Välkommen till vår referensguide! Vilken referensstil använder du?"],n=["Hmm, försök igen &#x1F635;","Typiskt, är det inte din uppkoppling kan felet ligga hos oss &#x1F6A7; Testa gärna igen.","&#x1F44E; Försök igen eller återkom senare..."];sleeping=window.setInterval(function(){window.clearInterval(sleeping),checkUp()},sleeptime),e?newMessage(randomReply(n),"bot"):newMessage(randomReply(t),"bot"),setTimeout(function(){startAlternatives()},300)},makeUserBubble=function(e){e.parentNode.parentNode.classList.add("selected"),e.parentNode.parentNode.classList.remove("active"),e.parentNode.parentNode.innerHTML="<p>"+e.textContent+"</p>"},showMenu=function(e){var t="",n=chat.querySelector("button.newmenu"),a=["Här är listan på källor igen... &#x1F64F;","&#x1F331; Varsågod, kolla in något annat!","Testa någon av de här... &#x1F64C;"],o=["Vilken typ av källa är referensen? &#x1F4DA; &#x1F4F0; &#x1F4CA;","Vad är det för typ av referens du undrar över?","Börja med att välja en kategori &#x2B50;"];n&&makeUserBubble(n),setTimeout(function(){e?newMessage(randomReply(a),"bot"):newMessage(randomReply(o),"bot"),refguide.menu.forEach(function(e,n){t+='<button class="choice menu" data-submenu="'+n+'">'+e.title+"</button>"}),setTimeout(function(){newMessage(t)},500)},500),sleeping=window.setInterval(function(){window.clearInterval(sleeping),checkUp()},sleeptime)},loadStyle=function(e){var t=["Ok, vänta... &#x1F4AA;","Ett ögonblick... &#x1F440;","En sekund bara... &#x1F60E;"];newMessage(randomReply(t),"bot"),getJSON("https://tools.kib.ki.se/jsonendpoint/referenceguide/"+e,function(e){if(e){var t="";t+='<button class="close" aria-label="Stäng">&times;</button>',refguide=e,refguide.examples.forEach(function(e){t+='<article id="'+e.id+'">\n                         <h3>'+e.title+"</h3>\n                         "+e.body+"\n                       </article>"}),content.innerHTML=t,showMenu()}else{var n=["&#x1F622; Oops, något gick fel...","Men... &#x1F621;","Något funkar inte just nu &#x1F62B;"];window.clearInterval(sleeping),newMessage(randomReply(n),"bot"),setTimeout(function(){init(!0)},300)}})},menuClick=function(e){var t="",n=refguide.menu[e.getAttribute("data-submenu")],a=["&#x1F44D; Vad vill du lära dig referera till?","Vad vill du veta mer om? &#x1F648;","Någon av de här som passar?"],o=["Jag vill välja en annan källa än "+n.title.toLowerCase()+" &#x1F61C;","Visa de andra källorna igen &#x1F633;",n.title+" i all ära, men kollar gärna något annat nu... &#x1F612;"];n.submenu.forEach(function(e){var a=n.id+"-"+e.id;t+='<button class="choice submenu" aria-controls="'+a+'" data-content="'+a+'">'+e.title+"</button>"}),t+='<br /><button class="choice submenu newmenu">'+randomReply(o)+"</button>",setTimeout(function(){newMessage(randomReply(a),"bot"),setTimeout(function(){newMessage(t)},300)},500)},toggleContent=function(e){var t=chat.querySelectorAll("button");e?(e.classList.add("show"),chat.setAttribute("aria-hidden","true"),content.setAttribute("aria-hidden","false"),content.tabIndex="0",content.focus()):(content.setAttribute("aria-hidden","true"),content.tabIndex="-1",chat.setAttribute("aria-hidden","false"),history.state&&"content"===history.state.id&&history.back(),setTimeout(function(){var e=document.querySelector(".content article.show");e&&(e.classList.remove("show"),chat.querySelector('button[data-content="'+e.id+'"]').focus())},300));for(var n=0;n<t.length;n+=1)t[n].tabIndex=e?"-1":"0"},subMenuClick=function(e){e.classList.contains("newmenu")?showMenu(!0):(toggleContent(document.getElementById(e.getAttribute("data-content"))),history.pushState({id:e.getAttribute("data-content")},"","#"+e.getAttribute("data-content")))};document.addEventListener("click",function(e){if(e.target.classList.contains("choice")&&(window.clearInterval(sleeping),e.target.classList.contains("submenu")||makeUserBubble(e.target),e.target.classList.contains("style")&&setTimeout(function(){loadStyle(e.target.textContent.toLowerCase())},500),e.target.classList.contains("menu")&&menuClick(e.target),e.target.classList.contains("submenu")&&subMenuClick(e.target),e.target.classList.contains("showstart")&&setTimeout(function(){startAlternatives()},300),e.target.classList.contains("showmenu")&&showMenu(!0),e.target.classList.contains("showinfo"))){var t=["Här kan du läsa mer om hur du refererar","På vår webbplats kan du läsa mer om referenser","Ok, kolla den här länken:"],n=["OK &#x1F60E;","Hur kommer jag tillbaka? &#x1F312;","Ok, jag är redo! &#x1F44C;"];setTimeout(function(){newMessage(randomReply(t)+' <a target="_new" href="https://kib.ki.se/skriva-referera/skriva-referenser">https://kib.ki.se/skriva-referera/skriva-referenser</a>',"bot"),setTimeout(function(){newMessage(refguide?'<button class="choice newmenu showmenu">'+randomReply(n)+"</button>":'<button class="choice newmenu showstart">'+randomReply(n)+"</button>")},300)},500)}e.target.classList.contains("close")&&(e.preventDefault(),history.back())}),document.addEventListener("keydown",function(e){27===e.keyCode&&"false"===content.getAttribute("aria-hidden")&&history.back()}),window.addEventListener("popstate",function(e){toggleContent(e.state&&e.state.id&&document.getElementById(e.state.id)?document.getElementById(e.state.id):"")}),setTimeout(function(){init()},500),window.location.hash.split("#")[1]&&history.replaceState("","",".");