"use strict";!function(){var e=void 0,t=void 0,n=45e3,a=document.querySelector(".chat"),o=document.querySelector(".content"),r=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.timeout=5e3,n.onload=function(){if(n.status>=200&&n.status<400)try{var e=JSON.parse(n.responseText);t(e)}catch(a){t(!1)}else t(!1)},n.ontimeout=function(){t(!1)},n.onerror=function(){t(!1)},n.send()},s=function(e){var t=arguments.length<=1||void 0===arguments[1]?"user":arguments[1],n=document.createElement("section"),o=function(e,t){setTimeout(function(){e.classList.add("show")},150*t?150*t:10)},r=void 0,s=function(){a.scrollTop+=Math.floor(n.offsetHeight/18)};if(n.classList.add("message"),n.classList.add(t),n.innerHTML="<p>"+e+"</p>",a.appendChild(n),r=window.setInterval(s,16),setTimeout(function(){window.clearInterval(r),a.scrollTop=a.scrollHeight},300),setTimeout(function(){n.classList.add("show")},10),"user"===t){for(var i=a.querySelectorAll("button:not(:disabled)"),l=0;l<i.length;l+=1)o(i[l],l);n.classList.add("active")}},i=function(e){return e[Math.floor(Math.random()*e.length)]},l=function(){s('<button class="choice style apa">APA</button><button class="choice style vancouver">Vancouver</button>')},u=function(){var t=document.querySelector(".active"),n=["Har du somnat? &#x1F634;","PubMed and Chill? &#x2615;","Är du kvar?","&#x2744; &#x1F331; &#x1F31E; &#x1F342;"];t&&t.parentNode.removeChild(t),s(i(n),"bot"),setTimeout(function(){var t=['Undrar du något kan du ringa <a href="tel:0852484000">08-524 840 00</a>, eller komma in till oss i KIB-labb mellan 11-16 på vardagar. &#x1F46B;','Kom in till oss i KIB-labb mellan 11-16 på vardagar om du behöver mer hjälp eller ring <a href="tel:0852484000">08-524 840 00</a>. &#x1F4F2;',"Vill du prata referenser med en riktig person? &#x1F4AC; Kom in till oss i KIB-labb mellan 11-16 på vardagar."];s(i(t),"bot"),setTimeout(function(){var t=["Jag vill veta mer om hur jag refererar &#x1F61E;","Vad är referenser nu igen? &#x1F631;","Kan jag läsa mer om referenser någonstans? &#x1F680;"],n=["Låt mig välja referensstil igen &#x1F4A1;","Jag vill sätta igång! &#x1F525;","Ok, kör &#x1F697;"],a=["Visa kategorierna igen tack &#x2705;","Ok, kör igen! &#x1F697;","Jag vill välja källa &#x1F44D;"];s(e?'<button class="choice newmenu showinfo">'+i(t)+'</button><br /><button class="choice newmenu showmenu">'+i(a)+"</button>":'<button class="choice newmenu showinfo">'+i(t)+'</button><br /><button class="choice newmenu showstart">'+i(n)+"</button>")},300)},500)},c=function(e){var a=["Hej, välkommen till KIBs referensguide! &#x1F603; I vilket format ska din referens vara? &#x1F64B;","Hej! &#x1F44B; Välkommen till vår referensguide! Vilken referensstil använder du?"],o=["Hmm, försök igen &#x1F635;","Typiskt, är det inte din uppkoppling kan felet ligga hos oss &#x1F6A7; Testa gärna igen.","&#x1F44E; Försök igen eller återkom senare..."];t=window.setInterval(function(){window.clearInterval(t),u()},n),e?s(i(o),"bot"):s(i(a),"bot"),setTimeout(function(){l()},300)},d=function(e){e.parentNode.parentNode.classList.add("selected"),e.parentNode.parentNode.classList.remove("active"),e.parentNode.innerHTML=e.textContent},m=function(o){var r="",l=a.querySelector("button.newmenu"),c=["Här är listan på källor igen... &#x1F64F;","&#x1F331; Varsågod, kolla in något annat!","Testa någon av de här... &#x1F64C;"],m=["Vilken typ av källa är referensen? &#x1F4DA; &#x1F4F0; &#x1F4CA;","Vad är det för typ av referens du undrar över?","Börja med att välja en kategori &#x2B50;"];l&&d(l),setTimeout(function(){o?s(i(c),"bot"):s(i(m),"bot"),e.menu.forEach(function(e,t){r+='<button class="choice menu" data-submenu="'+t+'">'+e.title+"</button>"}),setTimeout(function(){s(r)},500)},500),t=window.setInterval(function(){window.clearInterval(t),u()},n)},f=function(n){var a=["Ok, vänta... &#x1F4AA;","Ett ögonblick... &#x1F440;","En sekund bara... &#x1F60E;"];s(i(a),"bot"),r("https://tools.kib.ki.se/jsonendpoint/referenceguide/"+n,function(n){if(n){var a="";a+='<button class="close" aria-label="Stäng">&times;</button>',e=n,e.examples.forEach(function(e){a+='<article id="'+e.id+'">\n                         <h3>'+e.title+"</h3>\n                         "+e.body+"\n                       </article>"}),o.innerHTML=a,m()}else{var r=["&#x1F622; Oops, något gick fel...","Men... &#x1F621;","Något funkar inte just nu &#x1F62B;"];window.clearInterval(t),s(i(r),"bot"),setTimeout(function(){c(!0)},300)}})},b=function(t){var n="",a=e.menu[t.getAttribute("data-submenu")],o=["&#x1F44D; Vad vill du lära dig referera till?","Vad vill du veta mer om? &#x1F648;","Någon av de här som passar?"],r=["Jag vill välja en annan källa än "+a.title.toLowerCase()+" &#x1F61C;","Visa de andra källorna igen &#x1F633;",a.title+" i all ära, men kollar gärna något annat nu... &#x1F612;"];s(i(o),"bot"),a.submenu.forEach(function(e){var t=a.id+"-"+e.id;n+='<button class="choice submenu" aria-controls="'+t+'" data-content="'+t+'">'+e.title+"</button>"}),n+='<br /><button class="choice submenu newmenu">'+i(r)+"</button>",setTimeout(function(){s(n)},500)},v=function(e){var t=a.querySelectorAll("button");e?(e.classList.add("show"),a.setAttribute("aria-hidden","true"),o.setAttribute("aria-hidden","false"),o.tabIndex="0",o.focus()):(o.setAttribute("aria-hidden","true"),o.tabIndex="-1",a.setAttribute("aria-hidden","false"),setTimeout(function(){var e=document.querySelector(".content article.show");e&&(e.classList.remove("show"),a.querySelector('button[data-content="'+e.id+'"]').focus())},300));for(var n=0;n<t.length;n+=1)t[n].tabIndex=e?"-1":"0"},g=function(e){e.classList.contains("newmenu")?m(!0):v(document.getElementById(e.getAttribute("data-content")))};document.addEventListener("click",function(n){if(n.target.classList.contains("choice")&&(window.clearInterval(t),n.target.classList.contains("submenu")||d(n.target),n.target.classList.contains("style")&&f(n.target.textContent.toLowerCase()),n.target.classList.contains("menu")&&b(n.target),n.target.classList.contains("submenu")&&g(n.target),n.target.classList.contains("showstart")&&l(),n.target.classList.contains("showmenu")&&m(!0),n.target.classList.contains("showinfo"))){var a=["Här kan du läsa mer om hur du refererar","På vår webbplats kan du läsa mer om referenser","Ok, kolla den här länken:"];s(i(a)+' <a target="_new" href="https://kib.ki.se/skriva-referera/skriva-referenser">https://kib.ki.se/skriva-referera/skriva-referenser</a>',"bot"),setTimeout(function(){var t=["OK &#x1F60E;","Hur kommer jag tillbaka? &#x1F312;","Ok, jag är redo! &#x1F44C;"];s(e?'<button class="choice newmenu showmenu">'+i(t)+"</button>":'<button class="choice newmenu showstart">'+i(t)+"</button>")},300)}n.target.classList.contains("close")&&v()}),document.addEventListener("keydown",function(e){27===e.keyCode&&v()}),setTimeout(function(){c()},500)}();